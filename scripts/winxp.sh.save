#!/bin/bash
#-M q35 \

#export QEMU_AUDIO_DRV=alsa
#export QEMU_ALSA_DAC_BUFFER_SIZE=256
#export QEMU_ALSA_ADC_BUFFER_SIZE=256
#  -device usb-tablet,id=input0,usb_version=1 \
#  -display sdl \

modprobe vfio-pci

#sudo vfio-bind 0000:07:00.0 0000:07:00.1
#sleep 1

xrandr --output DFP1 --off

sudo kvm \
  -cpu host \
  -smp 4,sockets=1,cores=4,threads=1 \
  -M q35 \
  -m 3G \
  -ctrl-grab \
  -vga none \
  -net nic,model=virtio \
  -net user \
  -usb \
  -usbdevice host:045e:00d1 \
  -drive if=virtio,file=/home/tux/vms/winxp/winxp.img,media=disk \
  -drive if=scsi,file=/home/tux/vms/winxp/amdgfx.iso,media=cdrom \
  -drive if=scsi,file=/home/ani/Packages/iso/Windows.XP.2003.eXPerience.Edition.October.2011.iso,media=cdrom \
  -device ioh3420,bus=pcie.0,addr=1c,multifunction=on,port=1,chassis=1,id=root.1 \
  -device vfio-pci,host=07:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/tux/vms/roms/norom.bin \
  -device vfio-pci,host=07:00.1,bus=root.1,addr=00.1 \
  -boot menu=on,splash=/home/tux/vms/_splash/boot.jpg,splash-time=5000 \
  -no-acpi \
  -name winxp

xrandr --output DFP1 --auto --primary --right-of DFP2
